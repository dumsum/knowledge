
| **Theme**                                     | **Notes**                                                                                                                                                                                                                                                                                                                                                                                              | **Implementation**                                                                                                                                                                                                                                                                                                                                             | **Workaround**                                                                                                                                 | **Design Change**                                                                                                                                                                                                                                                         |
| --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Instruction Parsing**                       | - Needed tweaks to detect function vs instruction in `objdump` output.<br>- Only `.text` section analysed for [[Control Flow Graph\|CFG]] extraction, but other sections such as `.boot.text` are still parsed.<br>- Instructions parsed in code, not all present, doesn't handle unknowns gracefully.  <br>- Some instruction formats missing e.g. the lack of offset value in `sc.w zero,zero,(t0)`. | - Add missing instructions. (S-M - not difficult, but tedious)<br>- Improve instruction parsing to handle unknowns and missing formats. (S) - I'd still like to be able to progress the analysis even if we impose some default behaviours.<br>- Enhance CFG extraction to include all relevant code sections, or otherwise ignore unnecessary sections. (S-M) | - Patch out unnecessary sections (e.g. boot code) in the binary.                                                                               |                                                                                                                                                                                                                                                                           |
| **Control Flow Analysis**                     | - Loop detection / analysis doesn't handle jump tables well, incorrectly detects loops where there are none.<br>- Doesn't draw edges from one CFG to another.<br>- [[Worst Case Execution Time\|WCET]] analysis skips CFGs without an "end node".<br>- Assumes 32-bit instruction length, causing issues with [[Basic Block\|BB]] identification and control flow analysis.                            | - Ensure CFGs always have an "end node" regardless of whether it is a return. (S)                                                                                                                                                                                                                                                                              | - Build [[seL4]] with `-fno-jump-tables`.<br>- Compile seL4 without the RISC-V C extension (compressed instructions).                          | - Support to combine CFGs by inlining `noreturn` function calls or unconditional jumps to other functions. (M-L)                                                                                                                                                          |
| **Address / [[Data Cache\|DCache]] Analysis** | - Doesn't appear to cater for loads/stores for addresses in registers other than SP (or GP).<br>- Many instructions/operations not implemented for address simulation, several `NYI` and `TODO` in the codebase.                                                                                                                                                                                       | - Track addresses in all registers used for loads and stores. (M)<br>- Implement missing operations in address simulation. (M)                                                                                                                                                                                                                                 |                                                                                                                                                |                                                                                                                                                                                                                                                                           |
| **Pipeline Analysis**                         | - Data cache analysis currently ignored if Pipeline analysis selected.<br>- Hardcoded at 4 stages, lacks flexibility.<br>- No support for superscalar or out-of-order execution.<br>- No SMP support.<br>                                                                                                                                                                                              | - Integrate data cache analysis with Pipeline analysis. (S)<br>- Implement "Memory access" pipeline stage. (M)<br>                                                                                                                                                                                                                                             |                                                                                                                                                | - Add flexibility for other pipeline designs. (L)                                                                                                                                                                                                                         |
| **Other Assumptions and Limitations**         | - Assumes functions don't modify the stack pointer.<br>- Doesn't consider CSR instructions and registers.<br>- [[ARM]] specific: issues with condition codes and in particular, conditional returns.                                                                                                                                                                                                   | - Start only from C functions and manually analyse ASM setup code. (M)<br>- Support more [[RISC-V]] extensions, e.g. C extension, Zicsr extension. (M)<br>                                                                                                                                                                                                     | - seL4 really only directly modifies SP on kernel entry and exit and the behaviour is straight forward, we could likely patch out those lines. | - Build support for SP modification mid-function and its associated impact on addresses. (M)<br><br>If we also want to support analysis on ARM:<br>- Develop a strategic approach for handling condition codes. (L)<br>- Address conditional returns in control flow. (M) |
### References
1. [[Heptane]]
2. [[Analysis of Loops]]
3. [[Fast and Precise WCET Prediction by Separated Cache and Path Analyses]]
4. [[Pipeline Behavior Prediction for Superscalar Processors by Abstract Interpretation]]